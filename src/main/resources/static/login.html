<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>DualNet - Login</title>
    <style>
      body{font-family:Arial,Helvetica,sans-serif;margin:40px}
      form{max-width:400px}
      label{display:block;margin-top:12px}
      input{width:100%;padding:8px;margin-top:4px}
      .msg{padding:10px;background:#e6ffe6;border:1px solid #b5ffb5;margin-bottom:12px}
      .err{padding:10px;background:#ffe6e6;border:1px solid #ffb5b5;margin-bottom:12px}
    </style>
</head>
<body>
  <div id="nav-placeholder"></div>
  <script>
    (function(){
      fetch('/navbar.html')
        .then(r => r.ok ? r.text() : '')
        .then(html => { const ph = document.getElementById('nav-placeholder'); if (ph) ph.innerHTML = html; })
        .catch(() => {});
    })();
  </script>
  <h1>Anmelden</h1>
  <div id="message" style="display:none" class="msg">Erfolgreich angemeldet!</div>
  <div id="error" style="display:none" class="err"></div>

  <form id="loginForm" method="post" action="/login">
    <label for="identifier">Benutzername oder E‑Mail</label>
    <input id="identifier" name="identifier" autocomplete="username">

    <label for="password">Passwort</label>
    <input id="password" name="password" type="password" autocomplete="current-password" required>

    <button style="margin-top:12px; padding:8px 12px" type="submit">Anmelden</button>
  </form>

  <p style="margin-top:12px;">Noch keinen Account? <a href="/registration.html">Zur Registrierung</a></p>

  <script>
    const params = new URLSearchParams(location.search);
    const errDiv = document.getElementById('error');
    const msgDiv = document.getElementById('message');
    const e = params.get('error');
    if (e === 'missing') {
      errDiv.textContent = 'Fehler: Bitte Benutzername/E-Mail und Passwort angeben.';
      errDiv.style.display = 'block';
    } else if (e === 'invalid') {
      errDiv.textContent = 'Fehler: Ungültige Anmeldeinformationen.';
      errDiv.style.display = 'block';
    } else if (params.get('success') === '1') {
      msgDiv.style.display = 'block';
    }

    // Client-side convenience: one identifier field (username or email)
    document.getElementById('loginForm').addEventListener('submit', function (ev) {
      const id = document.getElementById('identifier').value.trim();
      const pw = document.getElementById('password').value || '';
      if (!id) {
        ev.preventDefault();
        errDiv.textContent = 'Fehler: Bitte Benutzername oder E‑Mail angeben.';
        errDiv.style.display = 'block';
        window.scrollTo(0,0);
        return;
      }
      if (!pw) {
        ev.preventDefault();
        errDiv.textContent = 'Fehler: Bitte Passwort angeben.';
        errDiv.style.display = 'block';
        window.scrollTo(0,0);
      }
    });
  </script>
</body>
</html>